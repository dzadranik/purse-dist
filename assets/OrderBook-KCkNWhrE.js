import{s as P}from"./store-BCHrIRqh.js";import{_ as Q,r as _,s as R,o as E,i as T,a as V,b as o,c as h,d as t,e as J,h as x,f as $,F as N,g as j,t as b,p as M,j as W}from"./index-CAYk1u0a.js";const C={getRestDepth:(n,U)=>fetch(`https://api.binance.com/api/v3/depth?symbol=${n}&limit=${U}`),getStreamDepth:n=>new WebSocket(`wss://stream.binance.com:9443/ws/${n}@depth`)},B=n=>(M("data-v-fe8fade6"),n=n(),W(),n),q={class:"custom-content__select-wrap"},z={class:"ml-5 custom-content__panel"},A={key:1,class:"d-flex"},G={class:"custom-content__column"},H=B(()=>t("colgroup",null,[t("col",{class:"custom-content__td-p"}),t("col",{class:"custom-content__td-p d-none"}),t("col",{class:"custom-content__td-total"})],-1)),K=B(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-right font-weight-black pr-0"},"Price"),t("th",{class:"text-right font-weight-black d-sm-table-cell d-none pr-0"},"Quantity"),t("th",{class:"text-right font-weight-black pr-0"},"Total")])],-1)),X={class:"pr-0"},Y={class:"d-sm-table-cell d-none pr-0"},Z={class:"pr-0"},tt={class:"custom-content__column"},et=B(()=>t("colgroup",null,[t("col",{class:"custom-content__td-p pr-0"}),t("col",{class:"custom-content__td-p d-none pr-0"}),t("col",{class:"custom-content__td-total pr-0"})],-1)),lt=B(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-right font-weight-black pr-0"},"Price"),t("th",{class:"text-right font-weight-black d-sm-table-cell d-none pr-0"},"Quantity"),t("th",{class:"text-right font-weight-black pr-0"},"Total")])],-1)),st={class:"pr-0"},ot={class:"d-sm-table-cell d-none pr-0"},at={class:"pr-0"},nt={__name:"OrderBook",setup(n){const U=[100,500,1e3],w=_(100),p=_(null),S=R({}),m=_(null),v=_(null),i=_([null,null]),g=_(!1),I=_(!1);function f(e,l){let a=e.reduce((s,[c,u])=>{const r=Number(c),d=Number(u);if(d>0){const y=(r*d).toFixed(5);return[...s,[r.toFixed(2),d.toFixed(5),y]]}return s},[]);return l&&(a=[...a,...l].slice(0,w.value)),a}function k(e=!1){i.value=[null,null],S.value={},m.value=null,v.value=null,g.value=!1,p.value&&p.value.close(),I.value=e}async function L(){try{g.value=!0;const l=await(await C.getRestDepth(P.currencyPairValue,w.value)).json();v.value=l.lastUpdateId,i.value=[f(l.bids),f(l.asks)],g.value=!1}catch{k(!0)}}function O(){const e=S.value,[l,a]=i.value;if(m.value){const s=(m.value+1).toString();m.value=null,S.value={},e[s]&&(i.value=[f(e[s].b,l),f(e[s].a,a)],m.value=e[s].u)}else if(v.value){for(const[s,c]of Object.entries(e))if(s>v.value&&v.value<c.u){const u=s.toString();i.value=[f(e[u].b,l),f(e[u].a,a)],m.value=e[u].u,v.value=null}}}async function F(){k(),L(),p.value=C.getStreamDepth(P.currencyPairValue.toLowerCase()),p.value.onmessage=function(e){let{a:l,b:a,u:s,U:c}=JSON.parse(e.data);S.value[c]={a:l,b:a,u:s},O()},p.value.onclose=function(e){e.wasClean||k(!0)},p.value.onerror=function(){k(!0)}}return E(()=>{F()}),T(()=>{k()}),(e,l)=>{const a=V("v-select"),s=V("v-alert"),c=V("v-skeleton-loader"),u=V("v-table");return o(),h(N,null,[t("div",q,[J(a,{label:"Limit",modelValue:w.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>w.value=r),F],items:U,density:"compact",variant:"outlined",class:"mx-5 mt-5"},null,8,["modelValue"])]),t("div",z,[I.value?(o(),x(s,{key:0,color:"error",title:"Ошибка",text:"Что-то пошло не так",class:"pb-6 mr-5 mt-5"})):(o(),h("div",A,[t("div",G,[g.value?(o(),x(c,{key:0,type:"table"})):(o(),x(u,{key:1,density:"compact","fixed-header":"",class:"pr-5 text-right custom-content__table"},{default:$(()=>[H,K,t("tbody",null,[(o(!0),h(N,null,j(i.value[0],([r,d,y],D)=>(o(),h("tr",{key:`bids${D}`},[t("td",X,b(r),1),t("td",Y,b(d),1),t("td",Z,b(y),1)]))),128))])]),_:1}))]),t("div",tt,[g.value?(o(),x(c,{key:0,type:"table"})):(o(),x(u,{key:1,density:"compact","fixed-header":"",class:"text-right custom-content__table"},{default:$(()=>[et,lt,t("tbody",null,[(o(!0),h(N,null,j(i.value[1],([r,d,y],D)=>(o(),h("tr",{key:`asks${D}`},[t("td",st,b(r),1),t("td",ot,b(d),1),t("td",at,b(y),1)]))),128))])]),_:1}))])]))])],64)}}},rt=Q(nt,[["__scopeId","data-v-fe8fade6"]]);export{rt as default};
